//     Backbone.js 0.5.3
//     (c) 2010 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://documentcloud.github.com/backbone
(function(a,b){if(typeof exports!=="undefined"){b(a,exports,require("underscore"))}else{if(typeof define==="function"&&define.amd){define("backbone",["underscore","jquery","exports"],function(d,e,c){b(a,c,d,e)})}else{a.Backbone=b(a,{},a._,(a.jQuery||a.Zepto||a.ender))}}}(this,function(o,b,w,e){var m=o.Backbone;var n=Array.prototype.slice;b.VERSION="0.5.3";b.noConflict=function(){o.Backbone=m;return b};b.emulateHTTP=false;b.emulateJSON=false;b.Events={bind:function(A,C,z){var y=this._callbacks||(this._callbacks={});var B=y[A]||(y[A]={});var x=B.tail||(B.tail=B.next={});x.callback=C;x.context=z;B.tail=x.next={};return this},unbind:function(A,B){var x,z,y;if(!A){this._callbacks=null}else{if(x=this._callbacks){if(!B){x[A]={}}else{if(z=x[A]){while((y=z)&&(z=z.next)){if(z.callback!==B){continue}y.next=z.next;z.context=z.callback=null;break}}}}}return this},trigger:function(x){var C,A,D,y,B,z=["all",x];if(!(A=this._callbacks)){return this}while(B=z.pop()){if(!(C=A[B])){continue}y=B=="all"?arguments:n.call(arguments,1);while(C=C.next){if(D=C.callback){D.apply(C.context||this,y)}}}return this}};b.Model=function(x,y){var z;x||(x={});if(z=this.defaults){if(w.isFunction(z)){z=z.call(this)}x=w.extend({},z,x)}this.attributes={};this._escapedAttributes={};this.cid=w.uniqueId("c");this.set(x,{silent:true});this._changed=false;this._previousAttributes=w.clone(this.attributes);if(y&&y.collection){this.collection=y.collection}this.initialize(x,y)};w.extend(b.Model.prototype,b.Events,{_changed:false,idAttribute:"id",initialize:function(){},toJSON:function(){return w.clone(this.attributes)},get:function(x){return this.attributes[x]},escape:function(x){var y;if(y=this._escapedAttributes[x]){return y}var z=this.attributes[x];return this._escapedAttributes[x]=w.escape(z==null?"":""+z)},has:function(x){return this.attributes[x]!=null},set:function(A,z){z||(z={});if(!A){return this}if(A.attributes){A=A.attributes}var y=this.attributes,C=this._escapedAttributes;if(!z.silent&&this.validate&&!this._performValidation(A,z)){return false}if(this.idAttribute in A){this.id=A[this.idAttribute]}var B=this._changing;this._changing=true;for(var x in A){var D=A[x];if(!w.isEqual(y[x],D)){y[x]=D;delete C[x];this._changed=true;if(!z.silent){this.trigger("change:"+x,this,D,z)}}}if(!B){if(!z.silent&&this._changed){this.change(z)}this._changing=false}return this},unset:function(x,y){if(!(x in this.attributes)){return this}y||(y={});var A=this.attributes[x];var z={};z[x]=void 0;if(!y.silent&&this.validate&&!this._performValidation(z,y)){return false}(this._unsetAttributes||(this._unsetAttributes=[])).push(x);delete this.attributes[x];delete this._escapedAttributes[x];if(x==this.idAttribute){delete this.id}this._changed=true;if(!y.silent){this.trigger("change:"+x,this,void 0,y);this.change(y)}return this},clear:function(z){z||(z={});var x;var y=this.attributes;var A={};for(x in y){A[x]=void 0}if(!z.silent&&this.validate&&!this._performValidation(A,z)){return false}this.attributes={};this._escapedAttributes={};this._changed=true;if(!z.silent){for(x in y){this.trigger("change:"+x,this,void 0,z)}this.change(z)}return this},fetch:function(y){y||(y={});var x=this;var z=y.success;y.success=function(C,A,B){if(!x.set(x.parse(C,B),y)){return false}if(z){z(x,C)}};y.error=c(y.error,x,y);return(this.sync||b.sync).call(this,"read",this,y)},save:function(z,y){y||(y={});if(z&&!this.set(z,y)){return false}var x=this;var A=y.success;y.success=function(E,C,D){if(!x.set(x.parse(E,D),y)){return false}if(A){A(x,E,D)}};y.error=c(y.error,x,y);var B=this.isNew()?"create":"update";return(this.sync||b.sync).call(this,B,this,y)},destroy:function(y){y||(y={});if(this.isNew()){return this.trigger("destroy",this,this.collection,y)}var x=this;var z=y.success;y.success=function(A){x.trigger("destroy",x,x.collection,y);if(z){z(x,A)}};y.error=c(y.error,x,y);return(this.sync||b.sync).call(this,"delete",this,y)},url:function(){var x=p(this.collection)||this.urlRoot||r();if(this.isNew()){return x}return x+(x.charAt(x.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(y,x){return y},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(x){this.trigger("change",this,x);this._previousAttributes=w.clone(this.attributes);this._unsetAttributes=null;this._changed=false},hasChanged:function(x){if(x){return this._previousAttributes[x]!=this.attributes[x]}return this._changed},changedAttributes:function(A){A||(A=this.attributes);var z=this._previousAttributes,B=this._unsetAttributes;var C=false;for(var y in A){if(!w.isEqual(z[y],A[y])){C||(C={});C[y]=A[y]}}if(B){C||(C={});var x=B.length;while(x--){C[B[x]]=void 0}}return C},previous:function(x){if(!x||!this._previousAttributes){return null}return this._previousAttributes[x]},previousAttributes:function(){return w.clone(this._previousAttributes)},_performValidation:function(z,y){var x=this.validate(z);if(x){if(y.error){y.error(this,x,y)}else{this.trigger("error",this,x,y)}return false}return true}});b.Collection=function(y,x){x||(x={});if(x.comparator){this.comparator=x.comparator}w.bindAll(this,"_onModelEvent","_removeReference");this._reset();if(y){this.reset(y,{silent:true})}this.initialize.apply(this,arguments)};w.extend(b.Collection.prototype,b.Events,{model:b.Model,initialize:function(){},toJSON:function(){return this.map(function(x){return x.toJSON()})},add:function(A,y){if(w.isArray(A)){for(var z=0,x=A.length;z<x;z++){this._add(A[z],y)}}else{this._add(A,y)}return this},remove:function(A,y){if(w.isArray(A)){for(var z=0,x=A.length;z<x;z++){this._remove(A[z],y)}}else{this._remove(A,y)}return this},get:function(x){if(x==null){return null}return this._byId[x.id!=null?x.id:x]},getByCid:function(x){return x&&this._byCid[x.cid||x]},at:function(x){return this.models[x]},sort:function(x){x||(x={});if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}this.models=this.sortBy(this.comparator);if(!x.silent){this.trigger("reset",this,x)}return this},pluck:function(x){return w.map(this.models,function(y){return y.get(x)})},reset:function(y,x){y||(y=[]);x||(x={});this.each(this._removeReference);this._reset();this.add(y,{silent:true});if(!x.silent){this.trigger("reset",this,x)}return this},fetch:function(x){x||(x={});var z=this;var y=x.success;x.success=function(C,A,B){z[x.add?"add":"reset"](z.parse(C,B),x);if(y){y(z,C)}};x.error=c(x.error,z,x);return(this.sync||b.sync).call(this,"read",this,x)},create:function(y,x){var z=this;x||(x={});y=this._prepareModel(y,x);if(!y){return false}var A=x.success;x.success=function(B,D,C){z.add(B,x);if(A){A(B,D,C)}};y.save(null,x);return y},parse:function(y,x){return y},chain:function(){return w(this.models).chain()},_reset:function(x){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(z,y){if(!(z instanceof b.Model)){var x=z;z=new this.model(x,{collection:this});if(z.validate&&!z._performValidation(z.attributes,y)){z=false}}else{if(!z.collection){z.collection=this}}return z},_add:function(z,y){y||(y={});z=this._prepareModel(z,y);if(!z){return false}var A=this.getByCid(z);if(A){throw new Error(["Can't add the same model to a set twice",A.id])}this._byId[z.id]=z;this._byCid[z.cid]=z;var x=y.at!=null?y.at:this.comparator?this.sortedIndex(z,this.comparator):this.length;this.models.splice(x,0,z);z.bind("all",this._onModelEvent);this.length++;y.index=x;if(!y.silent){z.trigger("add",z,this,y)}return z},_remove:function(z,y){y||(y={});z=this.getByCid(z)||this.get(z);if(!z){return null}delete this._byId[z.id];delete this._byCid[z.cid];var x=this.indexOf(z);this.models.splice(x,1);this.length--;y.index=x;if(!y.silent){z.trigger("remove",z,this,y)}this._removeReference(z);return z},_removeReference:function(x){if(this==x.collection){delete x.collection}x.unbind("all",this._onModelEvent)},_onModelEvent:function(z,y,A,x){if((z=="add"||z=="remove")&&A!=this){return}if(z=="destroy"){this._remove(y,x)}if(y&&z==="change:"+y.idAttribute){delete this._byId[y.previous(y.idAttribute)];this._byId[y.id]=y}this.trigger.apply(this,arguments)}});var u=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"];w.each(u,function(x){b.Collection.prototype[x]=function(){return w[x].apply(w,[this.models].concat(w.toArray(arguments)))}});b.Router=function(x){x||(x={});if(x.routes){this.routes=x.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var g=/:([\w\d]+)/g;var v=/\*([\w\d]+)/g;var d=/[-[\]{}()+?.,\\^$|#\s]/g;w.extend(b.Router.prototype,b.Events,{initialize:function(){},route:function(x,y,z){b.history||(b.history=new b.History);if(!w.isRegExp(x)){x=this._routeToRegExp(x)}b.history.route(x,w.bind(function(B){var A=this._extractParameters(x,B);z&&z.apply(this,A);this.trigger.apply(this,["route:"+y].concat(A))},this))},navigate:function(x,y){b.history.navigate(x,y)},_bindRoutes:function(){if(!this.routes){return}var y=[];for(var z in this.routes){y.unshift([z,this.routes[z]])}for(var A=0,x=y.length;A<x;A++){this.route(y[A][0],y[A][1],this[y[A][1]])}},_routeToRegExp:function(x){x=x.replace(d,"\\$&").replace(g,"([^/]*)").replace(v,"(.*?)");return new RegExp("^"+x+"$")},_extractParameters:function(x,y){return x.exec(y).slice(1)}});b.History=function(){this.handlers=[];w.bindAll(this,"checkUrl")};var l=/^#*/;var h=/msie [\w.]+/;var j=false;w.extend(b.History.prototype,{interval:50,getFragment:function(y,x){if(y==null){if(this._hasPushState||x){y=window.location.pathname;var z=window.location.search;if(z){y+=z}}else{y=window.location.hash}}y=decodeURIComponent(y.replace(l,""));if(!y.indexOf(this.options.root)){y=y.substr(this.options.root.length)}return y},start:function(z){if(j){throw new Error("Backbone.history has already been started")}this.options=w.extend({},{root:"/"},this.options,z);this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var y=this.getFragment();var x=document.documentMode;var B=(h.exec(navigator.userAgent.toLowerCase())&&(!x||x<=7));if(B){this.iframe=e('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(y)}if(this._hasPushState){e(window).bind("popstate",this.checkUrl)}else{if("onhashchange" in window&&!B){e(window).bind("hashchange",this.checkUrl)}else{setInterval(this.checkUrl,this.interval)}}this.fragment=y;j=true;var C=window.location;var A=C.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!A){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&A&&C.hash){this.fragment=C.hash.replace(l,"");window.history.replaceState({},document.title,C.protocol+"//"+C.host+this.options.root+this.fragment)}}if(!this.options.silent){return this.loadUrl()}},route:function(x,y){this.handlers.unshift({route:x,callback:y})},checkUrl:function(y){var x=this.getFragment();if(x==this.fragment&&this.iframe){x=this.getFragment(this.iframe.location.hash)}if(x==this.fragment||x==decodeURIComponent(this.fragment)){return false}if(this.iframe){this.navigate(x)}this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(z){var y=this.fragment=this.getFragment(z);var x=w.any(this.handlers,function(A){if(A.route.test(y)){A.callback(y);return true}});return x},navigate:function(x,y){var A=(x||"").replace(l,"");if(this.fragment==A||this.fragment==decodeURIComponent(A)){return}if(this._hasPushState){var z=window.location;if(A.indexOf(this.options.root)!=0){A=this.options.root+A}this.fragment=A;window.history.pushState({},document.title,z.protocol+"//"+z.host+A)}else{window.location.hash=this.fragment=A;if(this.iframe&&(A!=this.getFragment(this.iframe.location.hash))){this.iframe.document.open().close();this.iframe.location.hash=A}}if(y){this.loadUrl(x)}}});b.View=function(x){this.cid=w.uniqueId("view");this._configure(x||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var k=function(x){return e(x,this.el)};var a=/^(\S+)\s*(.*)$/;var s=["model","collection","el","id","attributes","className","tagName"];w.extend(b.View.prototype,b.Events,{tagName:"div",$:k,initialize:function(){},render:function(){return this},remove:function(){e(this.el).remove();return this},make:function(y,x,A){var z=document.createElement(y);if(x){e(z).attr(x)}if(A){e(z).html(A)}return z},delegateEvents:function(B){if(!(B||(B=this.events))){return}if(w.isFunction(B)){B=B.call(this)}this.undelegateEvents();for(var A in B){var C=this[B[A]];if(!C){throw new Error('Event "'+B[A]+'" does not exist')}var z=A.match(a);var y=z[1],x=z[2];C=w.bind(C,this);y+=".delegateEvents"+this.cid;if(x===""){e(this.el).bind(y,C)}else{e(this.el).delegate(x,y,C)}}},undelegateEvents:function(){e(this.el).unbind(".delegateEvents"+this.cid)},_configure:function(z){if(this.options){z=w.extend({},this.options,z)}for(var A=0,y=s.length;A<y;A++){var x=s[A];if(z[x]){this[x]=z[x]}}this.options=z},_ensureElement:function(){if(!this.el){var x=this.attributes||{};if(this.id){x.id=this.id}if(this.className){x["class"]=this.className}this.el=this.make(this.tagName,x)}else{if(w.isString(this.el)){this.el=e(this.el).get(0)}}}});var t=function(x,y){var z=i(this,x,y);z.extend=this.extend;return z};b.Model.extend=b.Collection.extend=b.Router.extend=b.View.extend=t;var q={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};b.sync=function(B,y,x){var z=q[B];var A={type:z,dataType:"json"};if(!x.url){A.url=p(y)||r()}if(!x.data&&y&&(B=="create"||B=="update")){A.contentType="application/json";A.data=JSON.stringify(y.toJSON())}if(b.emulateJSON){A.contentType="application/x-www-form-urlencoded";A.data=A.data?{model:A.data}:{}}if(b.emulateHTTP){if(z==="PUT"||z==="DELETE"){if(b.emulateJSON){A.data._method=z}A.type="POST";A.beforeSend=function(C){C.setRequestHeader("X-HTTP-Method-Override",z)}}}if(A.type!=="GET"&&!b.emulateJSON){A.processData=false}return e.ajax(w.extend(A,x))};var f=function(){};var i=function(y,x,z){var A;if(x&&x.hasOwnProperty("constructor")){A=x.constructor}else{A=function(){return y.apply(this,arguments)}}w.extend(A,y);f.prototype=y.prototype;A.prototype=new f();if(x){w.extend(A.prototype,x)}if(z){w.extend(A,z)}A.prototype.constructor=A;A.__super__=y.prototype;return A};var p=function(x){if(!(x&&x.url)){return null}return w.isFunction(x.url)?x.url():x.url};var r=function(){throw new Error('A "url" property or function must be specified')};var c=function(y,z,x){return function(A,B){var B=A===z?B:A;if(y){y(A,B,x)}else{z.trigger("error",A,B,x)}}};return b}));
